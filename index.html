<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Availability HLS Player</title>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Your existing CSS - No Changes */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0a0a0a; color: #fff; line-height: 1.6; overflow: hidden; height: 100vh; width: 100vw; }
        .player-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 1000; display: flex; flex-direction: column; }
        .video-wrapper { position: relative; width: 100%; height: 100%; background-image: url('https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgmRFi0nHGuUTPrZ5tR8sD2sWv1L3Oespy813FQb6uNLUuUqIN5zlOKlfIZj2cGvkEiNXvfvEjj3BeHhYEqz0aVaHpJd8QLFcoqFWNVq35HTtUJ5zfy0692k3vRQDZhUde5ll0Q_zYF75WND1Qw7Kb5LIprh9axSw8NNmM65vyJvdyJ9QBinhOI-AXAL20J/s1000/Untitled%20design%20(11).gif'); background-size: cover; background-position: center; }
        #videoPlayer { width: 100%; height: 100%; object-fit: contain; }
        .viewer-count { position: absolute; top: 15px; right: 15px; background: rgba(0, 0, 0, 0.4); color: white; padding: 5px 10px; border-radius: 5px; font-size: 13px; display: flex; align-items: center; gap: 6px; z-index: 1001; backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); font-weight: 500; transition: opacity 0.3s ease; }
        :fullscreen .viewer-count, :-webkit-full-screen .viewer-count { opacity: 0; pointer-events: none; }
        .controls-container { position: absolute; bottom: 0; left: 0; width: 100%; background: linear-gradient(to top, rgba(0,0,0,0.85), transparent); padding: 15px; transition: opacity 0.3s ease; z-index: 1002; }
        .controls { display: flex; flex-direction: column; gap: 12px; opacity: 1; transition: opacity 0.3s ease; }
        .controls.hidden { opacity: 0; pointer-events: none; }
        .progress-container { width: 100%; height: 5px; background: rgba(255, 255, 255, 0.2); border-radius: 3px; cursor: pointer; position: relative; }
        .progress-bar { height: 100%; background: #3498db; border-radius: 3px; width: 0%; position: relative; }
        .progress-buffer { position: absolute; height: 100%; background: rgba(255, 255, 255, 0.3); border-radius: 3px; width: 0%; }
        .controls-row { display: flex; align-items: center; justify-content: space-between; }
        .left-controls, .center-controls, .right-controls { display: flex; align-items: center; gap: 12px; }
        .control-btn { background: none; border: none; color: #fff; font-size: 18px; cursor: pointer; width: 38px; height: 38px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; }
        .control-btn:hover { background: rgba(255, 255, 255, 0.15); transform: scale(1.1); }
        .control-btn.large { font-size: 28px; }
        .time-display { font-size: 13px; color: #ddd; white-space: nowrap; }
        .volume-container { display: flex; align-items: center; gap: 8px; position: relative; }
        .volume-slider-container { position: relative; width: 70px; height: 18px; display: flex; align-items: center; }
        .volume-slider { width: 100%; height: 4px; -webkit-appearance: none; background: rgba(255, 255, 255, 0.2); border-radius: 2px; outline: none; position: relative; z-index: 2; }
        .volume-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 12px; height: 12px; border-radius: 50%; background: #3498db; cursor: pointer; box-shadow: 0 0 4px rgba(0, 0, 0, 0.5); }
        .volume-slider-fill { position: absolute; height: 4px; background: #3498db; border-radius: 2px; left: 0; top: 7px; z-index: 1; width: 100%; }
        .quality-selector { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.25); border-radius: 4px; color: #fff; padding: 5px 10px; cursor: pointer; font-size: 13px; }
        .quality-selector option { background: #2c2c2c; }
        .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #fff; font-size: 14px; background: rgba(0, 0, 0, 0.7); padding: 10px 20px; border-radius: 20px; z-index: 1001; display: flex; align-items: center; gap: 8px; }
        .error { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #ff4444; font-size: 14px; background: rgba(0, 0, 0, 0.8); padding: 15px; border-radius: 8px; text-align: center; z-index: 1001; display: none; max-width: 80%; }
        .center-play-btn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.5); border: none; color: #fff; font-size: 42px; width: 70px; height: 70px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 1001; transition: all 0.2s; opacity: 0; }
        .center-play-btn.visible { opacity: 1; }
        .center-play-btn:hover { background: rgba(0, 0, 0, 0.7); transform: translate(-50%, -50%) scale(1.1); }
        .autoplay-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1003; gap: 15px; }
        .autoplay-overlay.hidden { display: none; }
        .autoplay-message { font-size: 16px; text-align: center; max-width: 80%; }
        .autoplay-button { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 24px; font-size: 14px; font-weight: 600; cursor: pointer; transition: transform 0.2s; }
        .autoplay-button:hover { transform: scale(1.05); background: #2980b9; }
        .quality-menu { position: absolute; bottom: 55px; right: 15px; background: rgba(0, 0, 0, 0.85); border-radius: 6px; padding: 8px; z-index: 1003; display: none; flex-direction: column; gap: 4px; min-width: 130px; backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px); }
        .quality-menu.visible { display: flex; }
        .quality-option { padding: 6px 10px; border-radius: 3px; cursor: pointer; transition: background 0.2s; font-size: 13px; }
        .quality-option:hover { background: rgba(255, 255, 255, 0.1); }
        .quality-option.active { background: #3498db; color: #fff; font-weight: 600; }
        @media (max-width: 768px) { .controls { gap: 10px; } .control-btn { font-size: 16px; width: 34px; height: 34px; } .control-btn.large { font-size: 24px; } .time-display { font-size: 12px; } .volume-slider-container { width: 50px; } .quality-selector { padding: 4px 8px; font-size: 12px; } .viewer-count { right: 15px; } }
        @media (max-width: 480px) { .volume-slider-container { width: 40px; } .quality-selector { display: none; } .viewer-count { top: 10px; right: 10px; font-size: 11px; } .controls-container { padding: 10px; } .controls-row { flex-wrap: wrap; } .right-controls { margin-left: auto; } }
    </style>
</head>
<body>
    <div class="player-container">
        <div class="video-wrapper">
            <video id="videoPlayer" muted playsinline preload="auto"></video>
            <div class="loading" id="loadingIndicator">
                <i class="fas fa-spinner fa-spin"></i>
            </div>
            <div class="error" id="errorMessage"></div>
            <div class="autoplay-overlay" id="autoplayOverlay">
                <div class="autoplay-message"></div>
                <button class="autoplay-button" id="autoplayButton">
                    <i class="fas fa-play"></i> Start Streaming
                </button>
            </div>
            <div class="viewer-count">
                <i class="fas fa-users"></i> <span id="viewerCount">1.2K</span>
            </div>
            <button class="center-play-btn" id="centerPlayBtn">
                <i class="fas fa-play"></i>
            </button>
        </div>
        <div class="controls-container">
            <div class="controls" id="controls">
                <div class="progress-container" id="progressContainer">
                    <div class="progress-buffer" id="progressBuffer"></div>
                    <div class="progress-bar" id="progress"></div>
                </div>
                <div class="controls-row">
                    <div class="left-controls">
                        <button class="control-btn large" id="playPause"><i class="fas fa-pause"></i></button>
                        <div class="volume-container">
                            <button class="control-btn" id="volumeBtn"><i class="fas fa-volume-up"></i></button>
                            <div class="volume-slider-container">
                                <div class="volume-slider-fill" id="volumeSliderFill"></div>
                                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="1" step="0.01" value="1">
                            </div>
                        </div>
                        <div class="time-display" id="currentTime">0:00</div>
                        <div class="time-display">/</div>
                        <div class="time-display" id="duration">LIVE</div>
                    </div>
                    <div class="right-controls">
                        <button class="control-btn" id="fullscreenBtn"><i class="fas fa-expand"></i></button>
                        <button class="control-btn" id="pipBtn" title="Picture-in-Picture"><i class="fas fa-compress-alt"></i></button>
                        <button class="control-btn" id="qualityBtn" title="Quality Settings"><i class="fas fa-cog"></i></button>
                    </div>
                </div>
            </div>
        </div>
        <div class="quality-menu" id="qualityMenu">
            <div class="quality-option active" data-quality="auto">Auto</div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest" async></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Your existing variables - No Changes
            const video = document.getElementById('videoPlayer');
            const playPauseBtn = document.getElementById('playPause');
            const centerPlayBtn = document.getElementById('centerPlayBtn');
            const progress = document.getElementById('progress');
            const progressBuffer = document.getElementById('progressBuffer');
            const progressContainer = document.getElementById('progressContainer');
            const currentTimeEl = document.getElementById('currentTime');
            const durationEl = document.getElementById('duration');
            const volumeBtn = document.getElementById('volumeBtn');
            const volumeSlider = document.getElementById('volumeSlider');
            const volumeSliderFill = document.getElementById('volumeSliderFill');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            const pipBtn = document.getElementById('pipBtn');
            const qualityBtn = document.getElementById('qualityBtn');
            const qualityMenu = document.getElementById('qualityMenu');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const errorMessage = document.getElementById('errorMessage');
            const controls = document.getElementById('controls');
            const controlsContainer = document.querySelector('.controls-container');
            const autoplayOverlay = document.getElementById('autoplayOverlay');
            const autoplayButton = document.getElementById('autoplayButton');
            const viewerCount = document.getElementById('viewerCount');
            
            let controlsTimeout, hls, qualityLevels = [], currentLevel = -1, lastTap = 0, tapTimeout, mousemoveThrottle;

            // --- NEW CONFIGURATION FOR THIS CHANNEL ---
            
            // 1. Define your NEW list of 19 worker URLs
            const WORKER_URLS = [
                'https://ddos.heavy-ox-nsyj.workers.dev/',
                'https://ddos.amazing-falcon-rnmo.workers.dev/',
                'https://ddos.considerable-marten-jdqy.workers.dev/',
                'https://ddos.digital-lynx-ltyd.workers.dev/',
                'https://ddos.protestant-pelican-xleq.workers.dev/',
                'https://ddos.tall-ladybug-xjeo.workers.dev/',
                'https://ddos.spotty-unicorn-fscc.workers.dev/',
                'https://ddos.mammoth-piranha-mjmc.workers.dev/',
                'https://ddos.academic-cheetah-nyij.workers.dev/',
                'https://ddos.ok-capybara-vjxb.workers.dev/',
                'https://ddos.environmental-ferret-wlwb.workers.dev/',
                'https://ddos.smiling-dog-tyrn.workers.dev/',
                'https://ddos.sharp-condor-houc.workers.dev/',
                'https://ddos.healthy-clownfish-etgm.workers.dev/',
                'https://ddos.occasional-mongoose-vshr.workers.dev/',
                'https://ddos.aggressive-vicuna-zuss.workers.dev/',
                'https://ddos.curly-walrus-mfuc.workers.dev/',
                'https://ddos.underlying-condor-inlo.workers.dev/',
                'https://ddos.exuberant-octopus-ebxw.workers.dev/'
            ];

            // 2. Define the NEW channel stream URL
            const TARGET_STREAM_URL = 'https://stream-lb.livemedia.ma/arryadia-tnt/hls/stream_1/playlist.m3u8';
            
            // The failover logic remains the same
            let availableWorkers = [...WORKER_URLS];
            let currentWorkerUrl = '';
            let retryCount = 0;
            const MAX_RETRIES = 25; // Increased retries since we have more servers

            function getNextProxyUrl() {
                if (availableWorkers.length === 0) {
                    console.warn("Exhausted all workers. Resetting list for another round of retries.");
                    availableWorkers = [...WORKER_URLS];
                }
                const randomIndex = Math.floor(Math.random() * availableWorkers.length);
                const randomWorker = availableWorkers[randomIndex];
                availableWorkers.splice(randomIndex, 1);
                currentWorkerUrl = randomWorker;
                console.log(`Attempting to stream via: ${currentWorkerUrl}`);
                return `${randomWorker}?url=${encodeURIComponent(TARGET_STREAM_URL)}`;
            }

            // --- END OF NEW CONFIGURATION ---
            
            initPlayer();
            
            function initPlayer() {
                loadingIndicator.style.display = 'flex';
                if (typeof Hls !== 'undefined') {
                    setupHlsPlayer();
                } else {
                    const checkHls = setInterval(function() {
                        if (typeof Hls !== 'undefined') {
                            clearInterval(checkHls);
                            setupHlsPlayer();
                        }
                    }, 50);
                }
            }
            
            function setupHlsPlayer() {
                if (Hls.isSupported()) {
                    hls = new Hls({ enableWorker: true, lowLatencyMode: true, backBufferLength: 30, maxBufferLength: 30, autoStartLoad: false });
                    
                    const initialProxyUrl = getNextProxyUrl();
                    if (initialProxyUrl) {
                        hls.loadSource(initialProxyUrl);
                        hls.attachMedia(video);
                        hls.startLoad();
                    } else {
                        showError("Configuration error: No workers available.");
                        return;
                    }
                    
                    hls.on(Hls.Events.MANIFEST_PARSED, function() {
                        console.log('Manifest parsed successfully!');
                        retryCount = 0;
                        qualityLevels = hls.levels;
                        populateQualityMenu();
                        attemptAutoplay();
                    });
                    hls.on(Hls.Events.LEVEL_SWITCHED, function(event, data) {
                        currentLevel = data.level;
                        updateQualityMenu();
                    });

                    hls.on(Hls.Events.ERROR, function(event, data) {
                        console.error('HLS error:', data);
                        if (data.fatal) {
                            switch(data.type) {
                                case Hls.ErrorTypes.NETWORK_ERROR:
                                    console.error(`Fatal network error on worker: ${currentWorkerUrl}`);
                                    retryCount++;
                                    if (retryCount <= MAX_RETRIES) {
                                        showError(`Connection lost. Switching to backup server... (${retryCount}/${MAX_RETRIES})`);
                                        const nextProxyUrl = getNextProxyUrl();
                                        if (nextProxyUrl) {
                                            hls.loadSource(nextProxyUrl);
                                            hls.startLoad();
                                        } else {
                                            showError('All backup servers failed. Cannot recover.');
                                        }
                                    } else {
                                        showError('All backup servers failed after multiple retries. Please reload the page.');
                                    }
                                    break;
                                case Hls.ErrorTypes.MEDIA_ERROR:
                                    showError('Media error. Attempting to recover...');
                                    hls.recoverMediaError();
                                    break;
                                default:
                                    showError('An unrecoverable error occurred. Please reload the page.');
                                    break;
                            }
                        }
                    });

                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    const randomIndex = Math.floor(Math.random() * WORKER_URLS.length);
                    const randomWorker = WORKER_URLS[randomIndex];
                    video.src = `${randomWorker}?url=${encodeURIComponent(TARGET_STREAM_URL)}`;
                    video.addEventListener('loadedmetadata', function() {
                        attemptAutoplay();
                    });
                } else {
                    showError('Your browser does not support HLS playback.');
                }
            }
            
            // All of your other functions (populateQualityMenu, updateQualityMenu, etc.) remain unchanged.
            function populateQualityMenu(){while(qualityMenu.children.length>1){qualityMenu.removeChild(qualityMenu.lastChild)}const e=qualityMenu.querySelector('.quality-option[data-quality="auto"]');e&&e.addEventListener("click",()=>setQuality("auto"));const t=document.createDocumentFragment();qualityLevels.forEach((e,l)=>{const n=document.createElement("div");n.className="quality-option",n.dataset.quality=l,n.textContent=`${e.height}p (${Math.round(e.bitrate/1e3)}kbps)`,n.addEventListener("click",()=>setQuality(l)),t.appendChild(n)}),qualityMenu.appendChild(t),updateQualityMenu()}function updateQualityMenu(){const e=qualityMenu.querySelectorAll(".quality-option");e.forEach(e=>{const t=e.dataset.quality,l="auto"===t&&-1===currentLevel,n=parseInt(t)===currentLevel;l||n?e.classList.add("active"):e.classList.remove("active")})}function setQuality(e){hls&&(hls.currentLevel="auto"===e?-1:e,currentLevel=hls.currentLevel,updateQualityMenu(),qualityMenu.classList.remove("visible"))}function attemptAutoplay(){loadingIndicator.style.display="none";const e=video.play();void 0!==e&&e.then(()=>{autoplayOverlay.classList.add("hidden"),setTimeout(()=>{video.muted=!1,updateVolumeIcon()},1e3)}).catch(e=>{autoplayOverlay.classList.remove("hidden"),console.log("Autoplay prevented:",e)})}autoplayButton.addEventListener("click",function(){video.play().then(()=>{autoplayOverlay.classList.add("hidden"),video.muted=!1,updateVolumeIcon()}).catch(e=>{console.log("Play failed:",e),showError("Unable to play stream. Please try again.")})}),document.addEventListener("mousemove",function(){mousemoveThrottle||(mousemoveThrottle=setTimeout(function(){controls.classList.remove("hidden"),controlsContainer.style.opacity="1",clearTimeout(controlsTimeout),controlsTimeout=setTimeout(function(){video.paused||(controls.classList.add("hidden"),controlsContainer.style.opacity="0",qualityMenu.classList.remove("visible"))},3e3),mousemoveThrottle=null},100))}),qualityBtn.addEventListener("click",function(e){e.stopPropagation(),qualityMenu.classList.toggle("visible")}),document.addEventListener("click",function(e){qualityMenu.contains(e.target)||e.target===qualityBtn||qualityMenu.classList.remove("visible")}),video.addEventListener("play",function(){centerPlayBtn.classList.remove("visible"),playPauseBtn.innerHTML='<i class="fas fa-pause"></i>'}),video.addEventListener("pause",function(){centerPlayBtn.classList.add("visible"),playPauseBtn.innerHTML='<i class="fas fa-play"></i>'}),playPauseBtn.addEventListener("click",togglePlay),centerPlayBtn.addEventListener("click",togglePlay),video.addEventListener("click",handleVideoClick);function handleVideoClick(){const e=(new Date).getTime(),t=e-lastTap;t<300&&t>0?(clearTimeout(tapTimeout),video.paused||video.pause(),lastTap=0):(lastTap=e,tapTimeout=setTimeout(()=>{lastTap=0},300),controls.classList.remove("hidden"),controlsContainer.style.opacity="1",clearTimeout(controlsTimeout),controlsTimeout=setTimeout(function(){video.paused||(controls.classList.add("hidden"),controlsContainer.style.opacity="0")},3e3))}function togglePlay(){video.paused||video.ended?video.play():video.pause()}let lastProgressUpdate=0;video.addEventListener("timeupdate",function(){const e=Date.now();e-lastProgressUpdate>250&&(updateProgress(),lastProgressUpdate=e)}),progressContainer.addEventListener("click",function(e){const t=this.getBoundingClientRect(),l=(e.clientX-t.left)/this.offsetWidth;video.currentTime=l*video.duration});function updateProgress(){const e=video.currentTime/video.duration*100;progress.style.width=e+"%";if(video.buffered.length>0){const t=video.buffered.end(0)/video.duration*100;progressBuffer.style.width=t+"%"}currentTimeEl.textContent=formatTime(video.currentTime)}function formatTime(e){if(isNaN(e))return"0:00";const t=Math.floor(e/60),l=Math.floor(e%60);return t+":"+(l<10?"0":"")+l}volumeBtn.addEventListener("click",toggleMute);function toggleMute(){video.muted=!video.muted,updateVolumeIcon()}volumeSlider.addEventListener("input",function(){video.volume=volumeSlider.value,video.muted=0===video.volume,updateVolumeIcon(),updateVolumeSlider()});function updateVolumeIcon(){0===video.muted||0===video.volume?(volumeBtn.innerHTML='<i class="fas fa-volume-mute"></i>',volumeSlider.value=0):video.volume>.5?volumeBtn.innerHTML='<i class="fas fa-volume-up"></i>':video.volume>0?volumeBtn.innerHTML='<i class="fas fa-volume-down"></i>':volumeBtn.innerHTML='<i class="fas fa-volume-off"></i>',volumeSlider.value=video.volume,updateVolumeSlider()}function updateVolumeSlider(){volumeSliderFill.style.width=(video.muted?0:100*video.volume)+"%"}fullscreenBtn.addEventListener("click",toggleFullscreen);function toggleFullscreen(){document.fullscreenElement?document.exitFullscreen():(document.documentElement.requestFullscreen().catch(e=>{console.log("Fullscreen error:",e)}),fullscreenBtn.innerHTML='<i class="fas fa-compress"></i>')}pipBtn.addEventListener("click",togglePip);function togglePip(){document.pictureInPictureElement?document.exitPictureInPicture().catch(e=>{console.error("Error exiting Picture-in-Picture:",e)}):document.pictureInPictureEnabled&&video.requestPictureInPicture().catch(e=>{console.error("Error entering Picture-in-Picture:",e)})}document.pictureInPictureEnabled?(pipBtn.style.display="flex",video.addEventListener("enterpictureinpicture",function(){pipBtn.innerHTML='<i class="fas fa-expand-alt"></i>'}),video.addEventListener("leavepictureinpicture",function(){pipBtn.innerHTML='<i class="fas fa-compress-alt"></i>'})):pipBtn.style.display="none",video.addEventListener("waiting",function(){loadingIndicator.style.display="flex"}),video.addEventListener("playing",function(){loadingIndicator.style.display="none"});function showError(e){errorMessage.textContent=e,errorMessage.style.display="block",loadingIndicator.style.display="none"}updateVolumeIcon(),setInterval(()=>{const e=parseInt(viewerCount.textContent),t=Math.floor(5*Math.random())-2,l=Math.max(100,e+t);viewerCount.textContent=Math.round(l/100)*100>=1e3?(Math.round(l/100)/10).toFixed(1)+"K":l},1e4),window.addEventListener("beforeunload",function(){hls&&hls.destroy()});
        });
    </script>
</body>
</html>
